<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A+ Monitor - Trading Platform</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <!-- Plotly.js for charts -->
    <script src="https://cdn.plot.ly/plotly-2.27.1.min.js"></script>
    <style>
        .ticker-card {
            margin-bottom: 1.5rem;
            border-left: 4px solid #0d6efd;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .ticker-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .ticker-card .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
        }
        .ticker-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .ticker-symbol {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }
        .ticker-price {
            font-size: 1.1rem;
            font-weight: 600;
        }
        .price-change {
            font-size: 0.9rem;
            padding: 0.15rem 0.5rem;
            border-radius: 0.25rem;
        }
        .price-up {
            background-color: rgba(40, 167, 69, 0.15);
            color: #28a745;
        }
        .price-down {
            background-color: rgba(220, 53, 69, 0.15);
            color: #dc3545;
        }
        .setup-badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }
        .badge-breakout {
            background-color: rgba(40, 167, 69, 0.15);
            color: #28a745;
            border: 1px solid #28a745;
        }
        .badge-breakdown {
            background-color: rgba(220, 53, 69, 0.15);
            color: #dc3545;
            border: 1px solid #dc3545;
        }
        .badge-rejection {
            background-color: rgba(255, 193, 7, 0.15);
            color: #ffc107;
            border: 1px solid #ffc107;
        }
        .badge-bounce {
            background-color: rgba(13, 110, 253, 0.15);
            color: #0d6efd;
            border: 1px solid #0d6efd;
        }
        .timeframe-control {
            display: flex;
            justify-content: center;
            margin-bottom: 0.5rem;
        }
        .timeframe-btn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin: 0 0.15rem;
            background-color: #343a40;
            color: #fff;
            border: 1px solid #6c757d;
            cursor: pointer;
        }
        .timeframe-btn.active {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .chart-container {
            position: relative;
            height: 350px;
        }
        .trigger-line {
            position: absolute;
            width: 100%;
            border-top: 1px dashed;
            z-index: 5;
        }
        .trigger-line-breakout {
            border-color: #28a745;
        }
        .trigger-line-breakdown {
            border-color: #dc3545;
        }
        .trigger-line-rejection {
            border-color: #ffc107;
        }
        .trigger-line-bounce {
            border-color: #0d6efd;
        }
        .trigger-label {
            position: absolute;
            right: 10px;
            padding: 0.15rem 0.35rem;
            font-size: 0.7rem;
            border-radius: 0.25rem;
            z-index: 6;
            white-space: nowrap;
        }
        .setup-description {
            font-size: 0.85rem;
            color: #adb5bd;
            margin-bottom: 0.5rem;
        }
        .card-actions {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .historic-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .historic-toggle .form-check-input {
            margin-top: 0;
        }
        .date-selector {
            width: 200px;
            display: inline-block;
            margin-left: 1rem;
        }
        .no-setups-message {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }
        .loading-container {
            display: flex;
            justify-content: center;
            padding: 3rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">A+ Trading</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/recent-setups">Recent Setups</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/monitor">Monitor</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-8">
                <h1 class="mb-2">A+ Setup Monitor</h1>
                <p class="lead">View active trading setups and real-time price action</p>
            </div>
            <div class="col-md-4">
                <div class="historic-toggle text-end">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="historicToggle">
                        <label class="form-check-label" for="historicToggle">Historical View</label>
                    </div>
                    <input type="date" class="form-control date-selector" id="dateSelector" disabled>
                </div>
            </div>
        </div>

        <div id="monitorContainer">
            <div class="loading-container">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-center text-white mt-5 py-4">
        <div class="container">
            <p>Â© 2025 A+ Trading Platform</p>
        </div>
    </footer>

    <script>
        // Store for current data
        const tickerData = {};
        let activeTickers = [];
        let currentTimeframe = '5m';

        // Socket.IO connection for real-time updates
        let socket;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date selector with today's date
            const today = new Date();
            document.getElementById('dateSelector').valueAsDate = today;

            // Initialize historic toggle
            const historicToggle = document.getElementById('historicToggle');
            const dateSelector = document.getElementById('dateSelector');
            
            historicToggle.addEventListener('change', function() {
                dateSelector.disabled = !this.checked;
                if (this.checked) {
                    fetchHistoricalSetups(dateSelector.value);
                } else {
                    fetchActiveSetups();
                }
            });
            
            dateSelector.addEventListener('change', function() {
                if (historicToggle.checked) {
                    fetchHistoricalSetups(this.value);
                }
            });

            // Initialize Socket.IO connection
            initializeSocketConnection();
            
            // Fetch active setups
            fetchActiveSetups();
        });
        
        function initializeSocketConnection() {
            // Connect to Socket.IO server
            socket = io();
            
            // Connection events
            socket.on('connect', function() {
                console.log('Connected to real-time data server');
                // Subscribe to relevant data
                socket.emit('subscribe_setups');
            });
            
            socket.on('disconnect', function() {
                console.log('Disconnected from real-time data server');
            });
            
            // Setup notification event
            socket.on('new_setup', function(setupData) {
                console.log('New setup received:', setupData);
                // Refresh the active setups if in active mode
                if (!document.getElementById('historicToggle').checked) {
                    fetchActiveSetups();
                }
                // Show notification
                showSetupNotification(setupData);
            });
            
            // Market data event
            socket.on('market_data', function(data) {
                console.log('Market data received:', data);
                // Update the price for the ticker
                updateTickerPrice(data.ticker, data.price);
            });
        }
        
        function fetchActiveSetups() {
            // Show loading state
            const container = document.getElementById('monitorContainer');
            container.innerHTML = `
                <div class="loading-container">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            `;
            
            // Fetch active setups from API
            fetch('/api/setups/active')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        displaySetups(data.setups);
                        
                        // Subscribe to market data for these tickers
                        const tickers = data.setups.map(setup => setup.symbol);
                        activeTickers = tickers;
                        
                        if (socket && socket.connected) {
                            socket.emit('subscribe_tickers', { tickers: tickers });
                        }
                    } else {
                        showError('Failed to load active setups');
                    }
                })
                .catch(error => {
                    console.error('Error fetching active setups:', error);
                    showError('Error connecting to server');
                });
        }
        
        function fetchHistoricalSetups(dateStr) {
            // Show loading state
            const container = document.getElementById('monitorContainer');
            container.innerHTML = `
                <div class="loading-container">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            `;
            
            // Fetch historical setups from API
            fetch(`/api/setups/historical?date=${dateStr}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        displaySetups(data.setups, true);
                    } else {
                        showError('Failed to load historical setups');
                    }
                })
                .catch(error => {
                    console.error('Error fetching historical setups:', error);
                    showError('Error connecting to server');
                });
        }
        
        function displaySetups(setups, isHistorical = false) {
            const container = document.getElementById('monitorContainer');
            
            if (!setups || setups.length === 0) {
                container.innerHTML = `
                    <div class="no-setups-message">
                        <h4>No active setups found</h4>
                        <p>There are no trading setups active for ${isHistorical ? 'the selected date' : 'today'}.</p>
                    </div>
                `;
                return;
            }
            
            // Clear the container
            container.innerHTML = '';
            
            // Create a card for each setup
            setups.forEach(setup => {
                const card = createTickerCard(setup, isHistorical);
                container.appendChild(card);
                
                // Fetch and display chart data
                fetchChartData(setup.symbol, currentTimeframe).then(data => {
                    if (data) {
                        renderChart(setup.symbol, data, setup.signals);
                    }
                });
            });
        }
        
        function createTickerCard(setup, isHistorical) {
            const card = document.createElement('div');
            card.className = 'card ticker-card';
            card.id = `ticker-card-${setup.symbol}`;
            
            // Determine price change direction for styling
            const priceChangeClass = Math.random() > 0.5 ? 'price-up' : 'price-down';
            const priceChange = (Math.random() * 2 - 1).toFixed(2);
            
            // Create setup badges
            const setupBadges = setup.signals.map(signal => {
                return `<span class="setup-badge badge-${signal.category.toLowerCase()}">${signal.category}</span>`;
            }).join('');
            
            // Build card HTML
            card.innerHTML = `
                <div class="card-header">
                    <div class="ticker-header">
                        <h2 class="ticker-symbol">${setup.symbol}</h2>
                        ${setupBadges}
                    </div>
                    <div>
                        <span class="ticker-price" id="price-${setup.symbol}">${setup.last_price || '--'}</span>
                        <span class="price-change ${priceChangeClass}">${priceChange}%</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="setup-description">
                        ${getSetupDescription(setup)}
                    </div>
                    <div class="timeframe-control" data-symbol="${setup.symbol}">
                        <button class="timeframe-btn ${currentTimeframe === '1m' ? 'active' : ''}" data-timeframe="1m">1m</button>
                        <button class="timeframe-btn ${currentTimeframe === '5m' ? 'active' : ''}" data-timeframe="5m">5m</button>
                        <button class="timeframe-btn ${currentTimeframe === '15m' ? 'active' : ''}" data-timeframe="15m">15m</button>
                        <button class="timeframe-btn ${currentTimeframe === '1h' ? 'active' : ''}" data-timeframe="1h">1h</button>
                        <button class="timeframe-btn ${currentTimeframe === '1d' ? 'active' : ''}" data-timeframe="1d">1d</button>
                    </div>
                    <div class="chart-container" id="chart-${setup.symbol}">
                        <div class="loading-container">
                            <div class="spinner-border text-primary spinner-border-sm" role="status">
                                <span class="visually-hidden">Loading chart...</span>
                            </div>
                        </div>
                    </div>
                </div>
                ${!isHistorical ? `
                <div class="card-actions">
                    <div>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewDetails('${setup.symbol}')">View Details</button>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-success" onclick="placeOrder('${setup.symbol}', 'buy')">Buy</button>
                        <button class="btn btn-sm btn-danger" onclick="placeOrder('${setup.symbol}', 'sell')">Sell</button>
                    </div>
                </div>
                ` : ''}
            `;
            
            // Add event listeners for timeframe buttons
            setTimeout(() => {
                const timeframeContainer = card.querySelector('.timeframe-control');
                if (timeframeContainer) {
                    const buttons = timeframeContainer.querySelectorAll('.timeframe-btn');
                    buttons.forEach(btn => {
                        btn.addEventListener('click', function() {
                            const symbol = this.parentElement.getAttribute('data-symbol');
                            const timeframe = this.getAttribute('data-timeframe');
                            
                            // Update active button
                            buttons.forEach(b => b.classList.remove('active'));
                            this.classList.add('active');
                            
                            // Update chart
                            fetchChartData(symbol, timeframe).then(data => {
                                if (data) {
                                    renderChart(symbol, data, setup.signals);
                                }
                            });
                        });
                    });
                }
            }, 0);
            
            return card;
        }
        
        function getSetupDescription(setup) {
            if (!setup.signals || setup.signals.length === 0) {
                return 'No active signals for this ticker.';
            }
            
            // Build description based on signals
            const descriptions = [];
            setup.signals.forEach(signal => {
                let description = '';
                
                switch (signal.category.toLowerCase()) {
                    case 'breakout':
                        description = `Breakout setup above $${signal.trigger.price}`;
                        break;
                    case 'breakdown':
                        description = `Breakdown setup below $${signal.trigger.price}`;
                        break;
                    case 'rejection':
                        description = `Rejection setup at $${signal.trigger.price}`;
                        break;
                    case 'bounce':
                        description = `Bounce setup from $${signal.trigger.price}`;
                        break;
                    default:
                        description = `${signal.category} setup at $${signal.trigger.price}`;
                }
                
                // Add targets if available
                if (signal.targets && signal.targets.length > 0) {
                    const targetPrices = signal.targets.map(t => `$${t}`).join(', ');
                    description += ` with targets at ${targetPrices}`;
                }
                
                descriptions.push(description);
            });
            
            return descriptions.join('<br>');
        }
        
        function fetchChartData(symbol, timeframe) {
            return fetch(`/api/market/candles/${symbol}?timeframe=${timeframe}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        return data.data;
                    } else {
                        console.error('Error fetching chart data:', data.message);
                        return null;
                    }
                })
                .catch(error => {
                    console.error('Error fetching chart data:', error);
                    return null;
                });
        }
        
        function renderChart(symbol, data, signals) {
            const chartContainer = document.getElementById(`chart-${symbol}`);
            if (!chartContainer) return;
            
            // Clear loading indicator
            chartContainer.innerHTML = '';
            
            // Prepare data for Plotly
            const candlestick = {
                x: data.timestamp,
                open: data.open,
                high: data.high,
                low: data.low,
                close: data.close,
                type: 'candlestick',
                name: symbol,
                increasing: {line: {color: '#26a69a'}},
                decreasing: {line: {color: '#ef5350'}}
            };
            
            // Add volume as a bar chart
            const volume = {
                x: data.timestamp,
                y: data.volume,
                type: 'bar',
                name: 'Volume',
                marker: {
                    color: 'rgba(100, 100, 255, 0.3)'
                },
                yaxis: 'y2'
            };
            
            // Create shapes for triggers
            const shapes = [];
            if (signals && signals.length > 0) {
                signals.forEach((signal, index) => {
                    if (signal.trigger && signal.trigger.price) {
                        shapes.push({
                            type: 'line',
                            x0: 0,
                            x1: 1,
                            xref: 'paper',
                            y0: signal.trigger.price,
                            y1: signal.trigger.price,
                            line: {
                                color: getColorForSignal(signal.category),
                                width: 2,
                                dash: 'dash'
                            }
                        });
                    }
                });
            }
            
            // Create layout
            const layout = {
                title: {
                    text: `${symbol} Price Chart`,
                    font: {
                        size: 16
                    }
                },
                dragmode: 'zoom',
                showlegend: false,
                xaxis: {
                    rangeslider: {
                        visible: false
                    },
                    title: 'Time'
                },
                yaxis: {
                    title: 'Price ($)',
                    autorange: true,
                    fixedrange: false
                },
                yaxis2: {
                    title: 'Volume',
                    overlaying: 'y',
                    side: 'right',
                    showgrid: false
                },
                grid: {
                    rows: 1,
                    columns: 1
                },
                shapes: shapes,
                annotations: getAnnotationsForSignals(signals),
                margin: {
                    l: 50,
                    r: 50,
                    b: 50,
                    t: 50,
                    pad: 4
                },
                hovermode: 'closest',
                hoverlabel: {
                    bgcolor: '#343a40',
                    font: {color: 'white'}
                },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            // Create chart
            Plotly.newPlot(chartContainer, [candlestick, volume], layout, {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['sendDataToCloud', 'autoScale2d', 'resetScale2d', 'hoverClosestCartesian', 'hoverCompareCartesian', 'lasso2d', 'select2d']
            });
            
            // Add hover event for detailed price info
            chartContainer.on('plotly_hover', function(data) {
                const point = data.points[0];
                if (point.curveNumber === 0) { // Candlestick data
                    const index = point.pointNumber;
                    const timestamp = data.timestamp[index];
                    const open = data.open[index];
                    const high = data.high[index];
                    const low = data.low[index];
                    const close = data.close[index];
                    
                    // Update hover info (could be shown in a custom tooltip)
                    console.log(`Time: ${new Date(timestamp).toLocaleString()}, O: ${open}, H: ${high}, L: ${low}, C: ${close}`);
                }
            });
        }
        
        function getColorForSignal(category) {
            switch (category.toLowerCase()) {
                case 'breakout': return '#28a745';
                case 'breakdown': return '#dc3545';
                case 'rejection': return '#ffc107';
                case 'bounce': return '#0d6efd';
                default: return '#6c757d';
            }
        }
        
        function getAnnotationsForSignals(signals) {
            const annotations = [];
            
            if (signals && signals.length > 0) {
                signals.forEach((signal, index) => {
                    if (signal.trigger && signal.trigger.price) {
                        annotations.push({
                            x: 1,
                            y: signal.trigger.price,
                            xref: 'paper',
                            xanchor: 'right',
                            yanchor: 'middle',
                            text: `${signal.category} ($${signal.trigger.price})`,
                            font: {
                                size: 10,
                                color: getColorForSignal(signal.category)
                            },
                            showarrow: false,
                            bgcolor: 'rgba(0,0,0,0.5)',
                            bordercolor: getColorForSignal(signal.category),
                            borderwidth: 1,
                            borderpad: 4
                        });
                    }
                });
            }
            
            return annotations;
        }
        
        function updateTickerPrice(symbol, price) {
            const priceElement = document.getElementById(`price-${symbol}`);
            if (priceElement) {
                // Store the previous price for comparison
                const previousPrice = parseFloat(priceElement.textContent);
                
                // Update the price
                priceElement.textContent = price.toFixed(2);
                
                // Add a flash effect based on price change
                if (!isNaN(previousPrice)) {
                    if (price > previousPrice) {
                        priceElement.classList.add('price-up-flash');
                        setTimeout(() => priceElement.classList.remove('price-up-flash'), 1000);
                    } else if (price < previousPrice) {
                        priceElement.classList.add('price-down-flash');
                        setTimeout(() => priceElement.classList.remove('price-down-flash'), 1000);
                    }
                }
            }
        }
        
        function viewDetails(symbol) {
            window.location.href = `/ticker/${symbol}`;
        }
        
        function placeOrder(symbol, side) {
            const qty = 1; // Default quantity
            
            fetch('/api/execution/order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    symbol: symbol,
                    qty: qty,
                    side: side
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showNotification(`Order placed: ${side.toUpperCase()} ${qty} ${symbol}`, 'success');
                } else {
                    showNotification(`Error: ${data.message}`, 'danger');
                }
            })
            .catch(error => {
                console.error('Error placing order:', error);
                showNotification('Error connecting to server', 'danger');
            });
        }
        
        function showSetupNotification(setup) {
            // Create notification container if it doesn't exist
            let notificationContainer = document.getElementById('notification-container');
            if (!notificationContainer) {
                notificationContainer = document.createElement('div');
                notificationContainer.id = 'notification-container';
                notificationContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
                notificationContainer.style.zIndex = '1080';
                document.body.appendChild(notificationContainer);
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'toast show';
            notification.role = 'alert';
            notification.setAttribute('aria-live', 'assertive');
            notification.setAttribute('aria-atomic', 'true');
            
            // Format ticker badges
            let tickerBadges = '';
            if (setup.ticker_symbols && setup.ticker_symbols.length > 0) {
                tickerBadges = setup.ticker_symbols.map(symbol => 
                    `<span class="badge bg-primary me-1">${symbol}</span>`
                ).join('');
            }
            
            notification.innerHTML = `
                <div class="toast-header">
                    <strong class="me-auto">New Trading Setup</strong>
                    <small>${new Date().toLocaleTimeString()}</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    <div class="mb-2">${tickerBadges}</div>
                    <p class="mb-1">${setup.ticker_count} ticker(s) in this setup</p>
                    <div class="mt-2">
                        <button class="btn btn-sm btn-primary" onclick="refreshSetups()">View Now</button>
                    </div>
                </div>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Remove after 10 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 10000);
        }
        
        function showNotification(message, type = 'primary') {
            // Create notification container if it doesn't exist
            let notificationContainer = document.getElementById('notification-container');
            if (!notificationContainer) {
                notificationContainer = document.createElement('div');
                notificationContainer.id = 'notification-container';
                notificationContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
                notificationContainer.style.zIndex = '1080';
                document.body.appendChild(notificationContainer);
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'toast show';
            notification.role = 'alert';
            notification.setAttribute('aria-live', 'assertive');
            notification.setAttribute('aria-atomic', 'true');
            
            notification.innerHTML = `
                <div class="toast-header">
                    <strong class="me-auto">Notification</strong>
                    <small>${new Date().toLocaleTimeString()}</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        function showError(message) {
            const container = document.getElementById('monitorContainer');
            container.innerHTML = `
                <div class="alert alert-danger">
                    <h5>Error</h5>
                    <p>${message}</p>
                    <button class="btn btn-outline-danger btn-sm" onclick="refreshSetups()">Try Again</button>
                </div>
            `;
        }
        
        function refreshSetups() {
            if (document.getElementById('historicToggle').checked) {
                fetchHistoricalSetups(document.getElementById('dateSelector').value);
            } else {
                fetchActiveSetups();
            }
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>